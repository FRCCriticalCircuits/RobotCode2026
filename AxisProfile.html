<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Joystick Axis Curve Editor</title>
<style>
body {
    font-family: Arial;
    background: #111;
    color: #eee;
    display: flex;
    justify-content: center;
}

#container {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

canvas {
    background: #222;
    border: 1px solid #555;
    cursor: crosshair;
}

#panel {
    width: 220px;
    background: #1a1a1a;
    padding: 15px;
    border: 1px solid #444;
}

input {
    width: 100%;
    margin-bottom: 10px;
    padding: 6px;
}

button {
    width: 100%;
    padding: 6px;
    margin-bottom: 8px;
}

.selectedLabel {
    color: #00ff88;
}
</style>
</head>
<body>

<div id="container">
    <div>
        <canvas id="graph" width="600" height="400"></canvas>
        <br>
        <button onclick="addPoint()">Add Point</button>
        <button onclick="exportJSON()">Export JSON</button>
        <input type="file" accept=".json" onchange="loadJSON(event)">
    </div>

    <div id="panel">
        <h3>Selected Point</h3>
        <div id="pointInfo">None</div>

        <label>X (0-100)</label>
        <input type="number" id="xInput" min="0" max="100">

        <label>Y (0-100)</label>
        <input type="number" id="yInput" min="0" max="100">

        <button onclick="updatePoint()">Apply</button>
        <button onclick="deletePoint()">Delete</button>
    </div>
</div>

<script>
const canvas = document.getElementById("graph");
const ctx = canvas.getContext("2d");

let points = [
    {x:0, y:0},
    {x:100, y:100}
];

let selectedPoint = null;
let draggingPoint = null;

function sortPoints(){
    points.sort((a,b)=>a.x-b.x);
}

function draw(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Grid
    ctx.strokeStyle="#333";
    for(let i=0;i<=10;i++){
        let x=i*canvas.width/10;
        let y=i*canvas.height/10;
        ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
    }

    // Curve
    ctx.strokeStyle="#00ff88";
    ctx.beginPath();
    for(let i=0;i<points.length;i++){
        let px=points[i].x/100*canvas.width;
        let py=canvas.height-(points[i].y/100*canvas.height);
        if(i===0) ctx.moveTo(px,py);
        else ctx.lineTo(px,py);
    }
    ctx.stroke();

    // Points
    for(let p of points){
        let px=p.x/100*canvas.width;
        let py=canvas.height-(p.y/100*canvas.height);

        ctx.beginPath();
        ctx.arc(px,py,6,0,Math.PI*2);

        if(p===selectedPoint){
            ctx.fillStyle="#00ff88";
        } else {
            ctx.fillStyle="#ff5555";
        }

        ctx.fill();
    }
}

function addPoint(){
    points.push({x:50,y:50});
    sortPoints();
    draw();
}

canvas.addEventListener("mousedown", e=>{
    const rect=canvas.getBoundingClientRect();
    const mx=e.clientX-rect.left;
    const my=e.clientY-rect.top;

    for(let p of points){
        let px=p.x/100*canvas.width;
        let py=canvas.height-(p.y/100*canvas.height);
        if(Math.hypot(mx-px,my-py)<8){
            selectedPoint=p;
            draggingPoint=p;
            updatePanel();
            draw();
            return;
        }
    }

    selectedPoint=null;
    updatePanel();
    draw();
});

canvas.addEventListener("mousemove", e=>{
    if(!draggingPoint) return;

    const rect=canvas.getBoundingClientRect();
    let mx=e.clientX-rect.left;
    let my=e.clientY-rect.top;

    draggingPoint.x=Math.max(0,Math.min(100,mx/canvas.width*100));
    draggingPoint.y=Math.max(0,Math.min(100,(canvas.height-my)/canvas.height*100));

    sortPoints();
    updatePanel();
    draw();
});

canvas.addEventListener("mouseup", ()=>draggingPoint=null);
canvas.addEventListener("mouseleave", ()=>draggingPoint=null);

function updatePanel(){
    if(!selectedPoint){
        document.getElementById("pointInfo").innerText="None";
        document.getElementById("xInput").value="";
        document.getElementById("yInput").value="";
        return;
    }

    document.getElementById("pointInfo").innerText=
        `X: ${selectedPoint.x.toFixed(2)}\nY: ${selectedPoint.y.toFixed(2)}`;

    document.getElementById("xInput").value=selectedPoint.x.toFixed(2);
    document.getElementById("yInput").value=selectedPoint.y.toFixed(2);
}

function updatePoint(){
    if(!selectedPoint) return;

    let x=parseFloat(document.getElementById("xInput").value);
    let y=parseFloat(document.getElementById("yInput").value);

    if(isNaN(x)||isNaN(y)) return;

    selectedPoint.x=Math.max(0,Math.min(100,x));
    selectedPoint.y=Math.max(0,Math.min(100,y));

    sortPoints();
    draw();
    updatePanel();
}

function deletePoint(){
    if(!selectedPoint) return;

    if(points.length<=2) return;
    if(selectedPoint===points[0]||selectedPoint===points[points.length-1]) return;

    points=points.filter(p=>p!==selectedPoint);
    selectedPoint=null;
    updatePanel();
    draw();
}

function exportJSON(){
    const data={axisProfile:points};
    const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download="axis_profile.json";
    a.click();
    URL.revokeObjectURL(url);
}

function loadJSON(event){
    const file=event.target.files[0];
    if(!file) return;

    const reader=new FileReader();
    reader.onload=function(e){
        try{
            const data=JSON.parse(e.target.result);
            if(data.axisProfile && Array.isArray(data.axisProfile)){
                points=data.axisProfile;
                sortPoints();
                selectedPoint=null;
                updatePanel();
                draw();
            }
        }catch(err){
            alert("Invalid JSON");
        }
    };
    reader.readAsText(file);
}

draw();
</script>

</body>
</html>